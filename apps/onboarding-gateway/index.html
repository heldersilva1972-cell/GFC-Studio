<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>GFC Secure Access Setup</title>
    <meta name="description" content="Set up secure access to the GFC Private Network">
    <meta name="robots" content="noindex, nofollow">

    <!-- Security Headers (configured at server level) -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">

    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/svg+xml" href="assets/logo.svg">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="48" height="48" rx="8" fill="#0066CC" />
                    <path d="M24 12L32 18V30L24 36L16 30V18L24 12Z" stroke="white" stroke-width="2" fill="none" />
                    <circle cx="24" cy="24" r="4" fill="white" />
                </svg>
            </div>
            <h1>GFC Secure Access Setup</h1>
            <p class="subtitle">Connect your device to the GFC Private Network</p>
        </header>

        <!-- Main Content -->
        <main id="app">
            <!-- Loading State -->
            <div id="loading" class="state-container">
                <div class="spinner"></div>
                <p class="status-text">Verifying your invite...</p>
            </div>

            <!-- Error State: Invalid Token -->
            <div id="error-invalid" class="state-container hidden">
                <div class="icon-error">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                        <circle cx="32" cy="32" r="30" stroke="#DC2626" stroke-width="3" />
                        <path d="M22 22L42 42M42 22L22 42" stroke="#DC2626" stroke-width="3" stroke-linecap="round" />
                    </svg>
                </div>
                <h2>Invalid or Expired Invite</h2>
                <p>This setup link is invalid, expired, or has already been used.</p>
                <p class="help-text">Please request a new invite from an administrator.</p>
            </div>

            <!-- Error State: Onboarding Disabled -->
            <div id="error-disabled" class="state-container hidden">
                <div class="icon-warning">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                        <path d="M32 8L56 52H8L32 8Z" stroke="#F59E0B" stroke-width="3" fill="none" />
                        <path d="M32 24V36M32 40V44" stroke="#F59E0B" stroke-width="3" stroke-linecap="round" />
                    </svg>
                </div>
                <h2>Onboarding Temporarily Unavailable</h2>
                <p>New device onboarding is currently paused by the system administrator.</p>
                <p class="help-text">Please contact support for assistance.</p>
            </div>

            <!-- Setup Wizard -->
            <div id="wizard" class="wizard hidden">
                <!-- Progress Indicator -->
                <div class="progress-bar">
                    <div class="progress-step active" data-step="1">
                        <div class="step-circle">1</div>
                        <span class="step-label">App</span>
                    </div>
                    <div class="progress-line"></div>
                    <div class="progress-step" data-step="2">
                        <div class="step-circle">2</div>
                        <span class="step-label">Trust</span>
                    </div>
                    <div class="progress-line"></div>
                    <div class="progress-step" data-step="3">
                        <div class="step-circle">3</div>
                        <span class="step-label">Config</span>
                    </div>
                    <div class="progress-line"></div>
                    <div class="progress-step" data-step="4">
                        <div class="step-circle">4</div>
                        <span class="step-label">Connect</span>
                    </div>
                </div>

                <!-- Step 1: Download WireGuard -->
                <div id="step-1" class="step-content active">
                    <div class="step-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                            <rect x="12" y="8" width="40" height="48" rx="4" stroke="#0066CC" stroke-width="3"
                                fill="none" />
                            <circle cx="32" cy="32" r="8" fill="#0066CC" />
                        </svg>
                    </div>
                    <h2>Get WireGuard</h2>
                    <p>First, ensure you have the verified WireGuard app installed on this device.</p>
                    <p class="platform-info">Detected platform: <strong id="platform-name">Unknown</strong></p>

                    <div class="button-group">
                        <a id="download-link" href="https://www.wireguard.com/install/" target="_blank"
                            rel="noopener noreferrer" class="btn btn-secondary">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10 2v12m0 0l-4-4m4 4l4-4M3 16h14" />
                            </svg>
                            Download WireGuard App
                        </a>
                        <button id="next-step-1" class="btn btn-primary">
                            I have the app installed
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 4l6 6-6 6" />
                            </svg>
                        </button>
                    </div>

                    <!-- One-Click Option (Windows Only) -->
                    <div id="windows-one-click-container" class="one-click-banner hidden">
                        <div class="one-click-content">
                            <div class="one-click-badge">RECOMMENDED</div>
                            <h3>One-Click Windows Setup</h3>
                            <p>Automate everything! This script installs WireGuard, trusts the GFC Root CA, and
                                configures your VPN in one step.</p>
                            <button id="download-windows-setup" class="btn btn-primary btn-large">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2v12m0 0l-4-4m4 4l4-4M4 18h16" />
                                </svg>
                                Run One-Click Setup
                            </button>
                            <p class="help-text">Requires Administrative privileges. One-time UAC prompt.</p>
                        </div>
                    </div>
                    <!-- One-Click Option (Apple Only) -->
                    <div id="apple-one-click-container" class="one-click-banner hidden">
                        <div class="one-click-content">
                            <div class="one-click-badge">RECOMMENDED</div>
                            <h3>Apple One-Click Setup</h3>
                            <p>Get connected in seconds! This installable profile configures WireGuard and trusts the
                                GFC Root CA in one go.</p>
                            <button id="download-apple-profile" class="btn btn-primary btn-large">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2v12m0 0l-4-4m4 4l4-4M4 18h16" />
                                </svg>
                                Install Access Profile
                            </button>
                            <p class="help-text">Works on iOS & macOS. Requires System Settings approval.</p>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Establish Trust -->
                <div id="step-2" class="step-content">
                    <div class="step-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                            <path d="M32 12L52 22V36C52 46 44 54 32 58C20 54 12 46 12 36V22L32 12Z" stroke="#0066CC"
                                stroke-width="3" fill="none" />
                            <path d="M24 34l6 6 12-12" stroke="#0066CC" stroke-width="3" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                    <h2>Establish Trust</h2>
                    <p>To access the network without security warnings, you must install the GFC Root Certificate.</p>
                    <p class="instructions" id="cert-instructions">Click to download and follow the instructions to
                        trust the certificate.</p>

                    <div class="button-group">
                        <button id="download-cert" class="btn btn-secondary">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10 2v12m0 0l-4-4m4 4l4-4M3 16h14" />
                            </svg>
                            Download GFC Root Certificate
                        </button>
                        <button id="next-step-2" class="btn btn-primary">
                            Certificate Trusted
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 4l6 6-6 6" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Import Configuration -->
                <div id="step-3" class="step-content">
                    <div class="step-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                            <rect x="12" y="16" width="40" height="32" rx="2" stroke="#10B981" stroke-width="3"
                                fill="none" />
                            <path d="M32 26v12m-6-6h12" stroke="#10B981" stroke-width="3" stroke-linecap="round" />
                        </svg>
                    </div>
                    <h2>Import Configuration</h2>
                    <p>Click below to download your unique security profile.</p>
                    <p id="platform-instructions" class="instructions"></p>

                    <div class="button-group">
                        <button id="download-config" class="btn btn-primary btn-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2v12m0 0l-4-4m4 4l4-4M4 18h16" />
                            </svg>
                            Download Secure Access Profile
                        </button>
                        <button id="skip-to-test" class="btn btn-link">Skip to Test</button>
                    </div>
                </div>

                <!-- Step 4: Test Connection -->
                <div id="step-4" class="step-content">
                    <div class="step-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                            <circle cx="32" cy="32" r="24" stroke="#0066CC" stroke-width="3" fill="none" />
                            <path d="M22 32l8 8 12-16" stroke="#10B981" stroke-width="3" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                    <h2>Test Connection</h2>
                    <p>Turn on the VPN in your WireGuard app, then click Test below.</p>

                    <div class="button-group">
                        <button id="test-connection" class="btn btn-primary">
                            <span class="btn-text">Test Connection</span>
                            <span class="btn-spinner hidden"></span>
                        </button>
                    </div>

                    <!-- Test Result -->
                    <div id="test-result" class="alert hidden"></div>

                    <!-- Success Actions -->
                    <div id="success-actions" class="hidden">
                        <a href="/" class="btn btn-secondary">Go to Dashboard</a>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; <span id="year"></span> GFC System. All rights reserved.</p>
            <p class="footer-note">This is a secure onboarding gateway. Your privacy is protected.</p>
        </footer>
    </div>

    <script src="js/setup.js"></script>
</body>

</html>