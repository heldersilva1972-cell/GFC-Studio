@page "/ProtocolCapture"
@model GFC.BlazorServer.Pages.ProtocolCapture.IndexModel
@{
    ViewData["Title"] = "Protocol Capture & C# Generator";
}

<section class="pc-card">
    <h1>Protocol Capture &amp; C# Generator</h1>
    <p class="pc-note">
        Delete the <strong>ProtocolCapture</strong> folder and the commented lines in <code>Program.cs</code> to remove this feature.
    </p>
    <div class="pc-exit-row">
        <a class="pc-exit-link" href="/">‚Üê Exit to Dashboard</a>
    </div>

    @if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
    {
        <div class="pc-alert pc-alert-error">@Model.ErrorMessage</div>
    }
    else if (!string.IsNullOrWhiteSpace(Model.StatusMessage))
    {
        <div class="pc-alert pc-alert-info">@Model.StatusMessage</div>
    }

    <form method="post" class="pc-form">
        <input type="hidden" asp-for="PacketsJson" />
        <input type="hidden" asp-for="SelectedPacketId" />

        <div class="pc-field-group">
            <label asp-for="ControllerIp">Controller IP</label>
            <input asp-for="ControllerIp" placeholder="192.168.1.50" />
        </div>

        <div class="pc-field-group">
            <label asp-for="Port">Port</label>
            <input asp-for="Port" type="number" min="1" max="65535" />
        </div>

        <div class="pc-field-group">
            <label asp-for="InterfaceName">Interface Name</label>
            <input asp-for="InterfaceName" placeholder="Ethernet" />
        </div>

        <div class="pc-actions">
            <button type="submit" asp-page-handler="StartCapture">Start Capture</button>
            <button type="submit" asp-page-handler="StopAnalyze">Stop &amp; Analyze</button>
            <button type="submit" asp-page-handler="Clear">Clear Results</button>
        </div>

        <div class="pc-divider"></div>

        <h2>Captured Packets</h2>

        @if (Model.Packets.Any())
        {
            <table class="pc-table">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Length</th>
                        <th>Direction</th>
                        <th>Hex Preview</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var packet in Model.Packets)
                    {
                        <tr class="@(Model.SelectedPacketId == packet.Id ? "pc-selected-row" : string.Empty)">
                            <td>@packet.Id</td>
                            <td>@packet.Length</td>
                            <td>@packet.Direction</td>
                            <td><code>@packet.HexPreview</code></td>
                            <td>
                                <button type="submit"
                                        asp-page-handler="SelectPacket"
                                        asp-route-packetId="@packet.Id">
                                    Select
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="pc-empty">No packets yet. Start a capture to populate this list.</p>
        }

        <div class="pc-divider"></div>

        <h2>Packet Hex Viewer</h2>
        <textarea asp-for="SelectedPacketHex"
                  readonly
                  class="pc-hex-textarea"
                  placeholder="Select a packet to view its full hex dump."></textarea>

        <div class="pc-divider"></div>

        <h2>Generate C# Method</h2>
        <div class="pc-field-group">
            <label asp-for="GeneratedMethodName">Method Name</label>
            <input asp-for="GeneratedMethodName" placeholder="OpenDoor1" />
        </div>
        <button type="submit" asp-page-handler="GenerateCSharp">Generate C# from Selected Packet</button>

        <textarea asp-for="GeneratedCSharp"
                  readonly
                  class="pc-code-textarea"
                  placeholder="Generated method will appear here."></textarea>
    </form>
</section>

<style>
    .pc-card {
        max-width: 960px;
        margin: 2rem auto;
        background: #fff;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-family: "Segoe UI", Arial, sans-serif;
    }
    .pc-note {
        font-size: 0.9rem;
        color: #555;
        margin-bottom: 1rem;
    }
    .pc-form label {
        font-weight: bold;
        display: block;
        margin-bottom: 0.25rem;
    }
    .pc-form input, .pc-form textarea, .pc-form button {
        width: 100%;
        padding: 0.6rem;
        margin-bottom: 1rem;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1rem;
    }
    .pc-form button {
        background-color: #00509d;
        color: #fff;
        border: none;
        font-weight: 600;
        cursor: pointer;
    }
    .pc-form button:hover {
        background-color: #003d75;
    }
    .pc-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }
    .pc-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        font-size: 0.95rem;
    }
    .pc-table th, .pc-table td {
        border: 1px solid #e0e0e0;
        padding: 0.5rem;
        text-align: left;
    }
    .pc-table th {
        background-color: #f5f5f5;
    }
    .pc-table button {
        width: auto;
        padding: 0.4rem 0.8rem;
        margin: 0;
    }
    .pc-exit-row {
        text-align: right;
        margin-bottom: 1rem;
    }
    .pc-exit-link {
        font-weight: 600;
        color: #00509d;
        text-decoration: none;
    }
    .pc-exit-link:hover {
        text-decoration: underline;
    }
    .pc-selected-row {
        background-color: #eef5ff;
    }
    .pc-empty {
        color: #777;
        font-style: italic;
    }
    .pc-hex-textarea {
        min-height: 160px;
        font-family: Consolas, "Courier New", monospace;
        background: #fafafa;
    }
    .pc-code-textarea {
        min-height: 220px;
        font-family: Consolas, "Courier New", monospace;
        background: #fcfcfc;
    }
    .pc-divider {
        border-top: 1px solid #e0e0e0;
        margin: 2rem 0;
    }
    .pc-field-group {
        margin-bottom: 1rem;
    }
    .pc-alert {
        padding: 0.75rem 1rem;
        border-radius: 4px;
        margin-bottom: 1rem;
    }
    .pc-alert-error {
        background: #fdecea;
        color: #c62828;
        border: 1px solid #f5c6cb;
    }
    .pc-alert-info {
        background: #e3f2fd;
        color: #0d47a1;
        border: 1px solid #90caf9;
    }
</style>

