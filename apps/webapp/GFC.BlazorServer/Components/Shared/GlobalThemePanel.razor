// [NEW]
@using GFC.Core.Models
@inject IStudioService StudioService

<div class="global-theme-panel">
    <h4>Global Design System</h4>
    <p>Define your brand's core identity. Changes here will apply across the entire website instantly.</p>

    <div class="theme-section">
        <h5>Brand Colors</h5>
        <div class="row">
            <div class="col">
                <label>Primary</label>
                <input type="color" class="form-control form-control-color" @bind="designTokens.colors.primary" @oninput="UpdateTokens" />
            </div>
            <div class="col">
                <label>Secondary</label>
                <input type="color" class="form-control form-control-color" @bind="designTokens.colors.secondary" @oninput="UpdateTokens" />
            </div>
            <div class="col">
                <label>Accent</label>
                <input type="color" class="form-control form-control-color" @bind="designTokens.colors.accent" @oninput="UpdateTokens" />
            </div>
        </div>
    </div>

    <div class="theme-section">
        <h5>Typography</h5>
        <div class="form-group">
            <label>Heading Font</label>
            <select class="form-control" @bind="designTokens.typography.headingFont" @onchange="UpdateTokens">
                <option value="Outfit">Outfit</option>
                <option value="Inter">Inter</option>
                <option value="Roboto">Roboto</option>
            </select>
        </div>
        <div class="form-group">
            <label>Body Font</label>
            <select class="form-control" @bind="designTokens.typography.bodyFont" @onchange="UpdateTokens">
                <option value="Inter">Inter</option>
                <option value="Outfit">Outfit</option>
                <option value="Roboto">Roboto</option>
            </select>
        </div>
    </div>

    <div class="theme-section">
        <h5>Accessibility</h5>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="highContrastSwitch" @bind="designTokens.accessibility.highContrast" @onchange="UpdateTokens">
            <label class="form-check-label" for="highContrastSwitch">Enable High Contrast Mode</label>
        </div>
    </div>
</div>

@code {
    private DesignTokenModel designTokens = new DesignTokenModel();

    protected override async Task OnInitializedAsync()
    {
        // In a real app, you would load these from a settings file or database
        designTokens = await StudioService.GetDesignTokensAsync() ?? new DesignTokenModel();
    }

    private async Task UpdateTokens()
    {
        await StudioService.SaveDesignTokensAsync(designTokens);
        // The service will notify the preview iframe of the changes
    }
}
