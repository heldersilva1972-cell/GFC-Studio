@inject TutorialService TutorialService

@if (ShowBanner)
{
    <div class="tutorial-resume-banner fade-in">
        <div class="banner-content">
            <div class="banner-icon">
                <i class="bi bi-mortarboard-fill"></i>
            </div>
            <div class="banner-text">
                <h5 class="banner-title">Resume Member Onboarding Tutorial?</h5>
                <p class="banner-subtitle">You were on Step @TutorialService.CurrentState.CurrentStep of 10: @GetStepDescription()</p>
            </div>
            <div class="banner-actions">
                <button class="btn btn-outline-secondary btn-sm" @onclick="HandleCancel">
                    Cancel
                </button>
                <button class="btn btn-primary btn-sm" @onclick="HandleResume">
                    <i class="bi bi-play-fill me-1"></i>
                    Resume
                </button>
            </div>
        </div>
    </div>
}

<style>
    .tutorial-resume-banner {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9997;
        max-width: 600px;
        width: 90vw;
    }

    .tutorial-resume-banner.fade-in {
        animation: bannerSlideDown 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
    }

    @@keyframes bannerSlideDown {
        from {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    }

    .banner-content {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.95) 100%);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 20px 24px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(99, 102, 241, 0.2);
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .banner-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .banner-icon i {
        font-size: 1.5rem;
        color: white;
    }

    .banner-text {
        flex: 1;
    }

    .banner-title {
        font-size: 1rem;
        font-weight: 700;
        color: #1e293b;
        margin: 0 0 4px 0;
    }

    .banner-subtitle {
        font-size: 0.875rem;
        color: #64748b;
        margin: 0;
    }

    .banner-actions {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
    }

    .banner-actions .btn {
        border-radius: 8px;
        font-weight: 600;
        padding: 8px 16px;
    }

    @@media (max-width: 768px) {
        .banner-content {
            flex-direction: column;
            text-align: center;
        }

        .banner-actions {
            width: 100%;
            justify-content: center;
        }
    }
</style>

@code {
    [Parameter] public bool ShowBanner { get; set; }
    [Parameter] public EventCallback OnResume { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }

    private async Task HandleResume()
    {
        if (OnResume.HasDelegate)
        {
            await OnResume.InvokeAsync();
        }
    }

    private async Task HandleCancel()
    {
        await TutorialService.CancelTutorialAsync();
        if (OnCancel.HasDelegate)
        {
            await OnCancel.InvokeAsync();
        }
    }

    private string GetStepDescription()
    {
        return TutorialService.CurrentState.CurrentStep switch
        {
            1 => "Getting Started",
            2 => "Navigate to Membership",
            3 => "Add New Member",
            4 => "Fill Member Details",
            5 => "Record Dues Payment",
            6 => "Navigate to Dues",
            7 => "Mark Payment Complete",
            8 => "Navigate to Key Cards",
            9 => "Filter Needing Cards",
            10 => "Assign & Activate Card",
            _ => "In Progress"
        };
    }
}
