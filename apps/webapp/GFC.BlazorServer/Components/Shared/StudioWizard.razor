@using GFC.Core.Models
@using System.Text.Json

<div class="property-inspector">
    <h5>Properties Inspector</h5>
    @if (TargetSection != null)
    {
        <div class="p-3">
            <h6 class="border-bottom pb-2 mb-3">@TargetSection.ComponentType</h6>

            @switch (TargetSection.ComponentType)
            {
                case "Hero":
                    <div class="form-group">
                        <label>Headline</label>
                        <input type="text" class="form-control" value="@(_properties.GetValueOrDefault("headline", ""))" @oninput="(e) => UpdateProperty("headline", e.Value)" />
                    </div>
                    break;
                case "RichTextBlock":
                    <div class="form-group">
                        <label>Content</label>
                        <textarea class="form-control" rows="10" value="@(_properties.GetValueOrDefault("content", ""))" @oninput="(e) => UpdateProperty("content", e.Value)"></textarea>
                    </div>
                    break;
                default:
                    <p class="text-muted">No properties available for this component.</p>
                    break;
            }
        </div>
    }
    else
    {
        <p class="text-muted p-3">Select a component to see its properties.</p>
    }
</div>

@code {
    [Parameter]
    public StudioSection TargetSection { get; set; }

    [Parameter]
    public EventCallback<(string sectionId, string propertyName, object propertyValue)> OnPropertyChanged { get; set; }

    private Dictionary<string, object> _properties = new();

    protected override void OnParametersSet()
    {
        if (TargetSection != null && !string.IsNullOrEmpty(TargetSection.Content))
        {
            _properties = JsonSerializer.Deserialize<Dictionary<string, object>>(TargetSection.Content);
        }
        else
        {
            _properties = new();
        }
    }

    private async Task UpdateProperty(string key, object value)
    {
        _properties[key] = value;
        TargetSection.Content = JsonSerializer.Serialize(_properties);
        await OnPropertyChanged.InvokeAsync((TargetSection.ClientId.ToString(), key, value));
    }

    public class WizardWarning
    {
        public string Message { get; set; }
        public string Severity { get; set; } = "Warning";
    }

    public List<WizardWarning> Warnings { get; set; } = new();
}
