@namespace GFC.BlazorServer.Components.Shared
@using System.Text.Json
@using GFC.Core.Models
@inject HttpClient Http

<div class="animation-library">
    <div class="library-search">
        <input type="text" class="form-control" placeholder="Filter animations..." @oninput="FilterAnimations" />
    </div>
    <div class="library-list">
        @foreach (var anim in _filteredAnimations)
        {
            <div class="library-item">
                <div class="item-header">
                    <h6>@anim.Name</h6>
                    <button class="btn btn-sm btn-primary" @onclick="() => OnLoadAnimation.InvokeAsync(anim)">Load</button>
                </div>
                <p class="item-description">@anim.Description</p>
                <div class="item-tags">
                    @foreach (var tag in anim.Tags)
                    {
                        <span class="badge bg-secondary">@tag</span>
                    }
                </div>
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public EventCallback<AnimationDefinition> OnLoadAnimation { get; set; }

    private List<AnimationDefinition> _allAnimations = new();
    private List<AnimationDefinition> _filteredAnimations = new();
    private string _filterTerm = "";

    protected override async Task OnInitializedAsync()
    {
        _allAnimations = await Http.GetFromJsonAsync<List<AnimationDefinition>>("sample-data/animations.json");
        _filteredAnimations = _allAnimations;
    }

    private void FilterAnimations(ChangeEventArgs e)
    {
        _filterTerm = e.Value.ToString().ToLower();
        if (string.IsNullOrWhiteSpace(_filterTerm))
        {
            _filteredAnimations = _allAnimations;
        }
        else
        {
            _filteredAnimations = _allAnimations
                .Where(a => a.Name.ToLower().Contains(_filterTerm) ||
                            a.Description.ToLower().Contains(_filterTerm) ||
                            a.Tags.Any(t => t.ToLower().Contains(_filterTerm)))
                .ToList();
        }
    }
}
