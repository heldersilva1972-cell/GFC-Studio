@using Microsoft.AspNetCore.Components.Web

<Microsoft.AspNetCore.Components.Web.ErrorBoundary @ref="_boundary" OnError="HandleError">
    <ChildContent>
        @ChildContent
    </ChildContent>
    <ErrorContent>
        <div class="app-error data-card" role="alert">
            <div class="app-error__icon" aria-hidden="true">
                <i class="bi bi-exclamation-octagon"></i>
            </div>
            <div class="app-error__body">
                <p class="app-error__title">Something went wrong.</p>
                <p class="app-error__subtitle">
                    We could not load this section. You can reload the page or return to the dashboard.
                </p>
                <div class="app-error__actions">
                    <button class="btn btn-primary btn-sm" type="button" @onclick="Reload">Reload page</button>
                    <a class="btn btn-outline btn-sm" href="/">Go to dashboard</a>
                </div>
            </div>
        </div>
    </ErrorContent>
</Microsoft.AspNetCore.Components.Web.ErrorBoundary>

@code {
    private Microsoft.AspNetCore.Components.Web.ErrorBoundary? _boundary;

    [Parameter] public RenderFragment? ChildContent { get; set; }

    [Inject] NavigationManager Navigation { get; set; } = default!;
    [Inject] ILogger<AppErrorBoundary> Logger { get; set; } = default!;

    private void Reload() => Navigation.NavigateTo(Navigation.Uri, forceLoad: true);

    private void HandleError(Exception exception)
    {
        // Log the actual error so we can diagnose it
        Logger.LogError(exception, "Error boundary caught exception on page: {Uri}", Navigation.Uri);
        Console.WriteLine($"ERROR BOUNDARY: {exception.GetType().Name}: {exception.Message}");
        Console.WriteLine($"Stack: {exception.StackTrace}");
        
        if (exception.InnerException != null)
        {
            Console.WriteLine($"Inner Exception: {exception.InnerException.GetType().Name}: {exception.InnerException.Message}");
        }
    }
}
