@namespace GFC.BlazorServer.Components.Shared
@using GFC.Core.Models

<div class="animation-canvas-container">
    <div class="sample-element" style="@_elementStyle">
        Animate Me!
    </div>
</div>

@code {
    [Parameter]
    public List<AnimationKeyframe> Keyframes { get; set; } = new();

    [Parameter]
    public double CurrentTime { get; set; }

    private string _elementStyle = "";

    protected override void OnParametersSet()
    {
        CalculateStyles();
    }

    private void CalculateStyles()
    {
        var styles = new Dictionary<string, string>();
        styles["opacity"] = "1";
        styles["transform"] = "none";

        foreach (var keyframe in Keyframes.Where(k => k.Target == "Element").OrderBy(k => k.Delay))
        {
            if (CurrentTime >= keyframe.Delay && CurrentTime <= keyframe.Delay + keyframe.Duration)
            {
                double progress = (CurrentTime - keyframe.Delay) / keyframe.Duration;

                switch (keyframe.Effect)
                {
                    case "fadeIn":
                        styles["opacity"] = progress.ToString("F3");
                        break;
                    case "slideLeft":
                        styles["transform"] = $"translateX({(1 - progress) * -100}px)";
                        break;
                    // Add other effects here...
                }
            }
        }

        _elementStyle = string.Join(";", styles.Select(s => $"{s.Key}:{s.Value}"));
    }
}
