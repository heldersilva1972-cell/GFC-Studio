@inject TutorialService TutorialService
@inject NavigationManager NavManager
@implements IDisposable

<div class="tutorial-start-card card shadow-sm border-0 rounded-4 overflow-hidden" data-tutorial="start-card">
    <div class="card-gradient"></div>
    <div class="card-body p-4 position-relative">
        <div class="d-flex align-items-start gap-3">
            <div class="tutorial-icon">
                <i class="bi bi-mortarboard-fill"></i>
            </div>
            <div class="flex-grow-1">
                <h5 class="card-title fw-bold mb-2">
                    <i class="bi bi-stars me-2 text-warning"></i>
                    Quick Start Guide
                </h5>
                <p class="card-text text-muted mb-3">
                    Learn how to add a new member, record their dues, and activate their access card in just a few minutes.
                </p>
                <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-primary btn-modern" @onclick="StartWithSample">
                        <i class="bi bi-play-fill me-2"></i>
                        Start Tutorial
                    </button>
                    <button class="btn btn-outline-secondary btn-modern" @onclick="StartWithReal">
                        <i class="bi bi-person-plus me-2"></i>
                        Guide Me (Real Data)
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .tutorial-start-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
        border: 2px solid transparent;
        transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .tutorial-start-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .tutorial-start-card:hover::before {
        opacity: 1;
    }

    .tutorial-start-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(99, 102, 241, 0.15);
        border-color: rgba(99, 102, 241, 0.2);
    }

    .card-gradient {
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
        pointer-events: none;
    }

    .tutorial-icon {
        width: 56px;
        height: 56px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
        animation: iconFloat 3s ease-in-out infinite;
    }

    .tutorial-icon i {
        font-size: 1.75rem;
        color: white;
    }

    @@keyframes iconFloat {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-6px);
        }
    }

    .btn-modern {
        border-radius: 10px;
        padding: 10px 20px;
        font-weight: 600;
        transition: all 0.2s cubic-bezier(0.4, 0.0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .btn-modern::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }

    .btn-modern:hover::before {
        width: 300px;
        height: 300px;
    }

    .btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .btn-primary.btn-modern {
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .btn-primary.btn-modern:hover {
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    }
</style>

@code {
    [Parameter] public EventCallback OnTutorialStarted { get; set; }

    protected override void OnInitialized()
    {
        TutorialService.OnTutorialStateChanged += HandleStateChanged;
    }

    private void HandleStateChanged()
    {
        InvokeAsync(StateHasChanged);
        if (OnTutorialStarted.HasDelegate)
        {
            InvokeAsync(() => OnTutorialStarted.InvokeAsync());
        }
    }

    private async Task StartWithSample()
    {
        try
        {
            await TutorialService.StartTutorialAsync(useSampleMode: true);
            await InvokeAsync(StateHasChanged);
            if (OnTutorialStarted.HasDelegate)
            {
                await OnTutorialStarted.InvokeAsync();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error starting tutorial: {ex.Message}");
            // Don't re-throw - just log
        }
    }

    private async Task StartWithReal()
    {
        try
        {
            await TutorialService.StartTutorialAsync(useSampleMode: false);
            await InvokeAsync(StateHasChanged);
            if (OnTutorialStarted.HasDelegate)
            {
                await OnTutorialStarted.InvokeAsync();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error starting tutorial: {ex.Message}");
            // Don't re-throw - just log
        }
    }

    public void Dispose()
    {
        TutorialService.OnTutorialStateChanged -= HandleStateChanged;
    }
}
