<!-- [NEW] -->
@page "/cameras/view"
@using GFC.Core.Models
@inject GFC.BlazorServer.Services.Camera.ICameraService CameraService

<PageTitle>View Cameras</PageTitle>

<div class="camera-view-container">
    <div class="camera-sidebar">
        <h4 class="mb-3">Cameras</h4>
        @if (_allCameras == null)
        {
            <p><em>Loading cameras...</em></p>
        }
        else
        {
            <div class="list-group">
                @foreach (var camera in _allCameras)
                {
                    <button class="list-group-item list-group-item-action @(IsCameraSelected(camera) ? "active" : "")"
                            @onclick="() => ToggleCameraSelection(camera)">
                        <span class="status-dot @(camera.IsEnabled ?? false ? "status-green" : "status-red")"></span>
                        @camera.Name
                    </button>
                }
            </div>
        }
    </div>
    <div class="camera-main-stage">
        <div class="camera-tabs">
            <button class="tab-button active">Live</button>
            <button class="tab-button">Recorded</button>
        </div>
        <div class="camera-grid @_gridClass">
            @foreach (var camera in _selectedCameras)
            {
                <GFC.BlazorServer.Components.Shared.CameraFeed Camera="camera" />
            }
        </div>
    </div>
</div>

@code {
    private List<Camera> _allCameras;
    private List<Camera> _selectedCameras = new();
    private string _gridClass = "";

    protected override async Task OnInitializedAsync()
    {
        _allCameras = await CameraService.GetAllCamerasAsync();
        // Select the first camera by default
        if (_allCameras != null && _allCameras.Any())
        {
            ToggleCameraSelection(_allCameras.First());
        }
    }

    private void ToggleCameraSelection(Camera camera)
    {
        if (IsCameraSelected(camera))
        {
            _selectedCameras.Remove(camera);
        }
        else
        {
            _selectedCameras.Add(camera);
        }
        UpdateGridClass();
    }

    private bool IsCameraSelected(Camera camera)
    {
        return _selectedCameras.Contains(camera);
    }

    private void UpdateGridClass()
    {
        _gridClass = _selectedCameras.Count switch
        {
            1 => "grid-1x1",
            2 => "grid-1x2",
            <= 4 => "grid-2x2",
            _ => "grid-3x3"
        };
    }
}

<style>
    .camera-view-container {
        display: flex;
        height: calc(100vh - 80px); /* Full height minus nav bar */
    }

    .camera-sidebar {
        width: 250px;
        padding: 1rem;
        background-color: #f8f9fa;
        border-right: 1px solid #dee2e6;
        overflow-y: auto;
    }

    .camera-main-stage {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .camera-tabs {
        padding: 0.5rem 1rem;
        border-bottom: 1px solid #dee2e6;
    }

    .tab-button {
        background-color: transparent;
        border: none;
        padding: 0.5rem 1rem;
        cursor: pointer;
    }

    .tab-button.active {
        border-bottom: 2px solid #0d6efd;
        font-weight: bold;
    }

    .camera-grid {
        flex-grow: 1;
        background-color: #000;
        display: grid;
        gap: 2px;
    }

    .grid-1x1 { grid-template-columns: 1fr; grid-template-rows: 1fr; }
    .grid-1x2 { grid-template-columns: repeat(2, 1fr); grid-template-rows: 1fr; }
    .grid-2x2 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); }
    .grid-3x3 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); }

    .status-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
    }

    .status-green { background-color: #28a745; }
    .status-red { background-color: #dc3545; }
</style>
