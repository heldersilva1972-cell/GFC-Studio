<!-- [NEW] -->
@page "/cameras/{CameraId:int}"
@inject GFC.BlazorServer.Services.Camera.ICameraService CameraService
@inject IJSRuntime JSRuntime
@inject IConfiguration Configuration

<PageTitle>Live View: @(_camera?.Name)</PageTitle>

@if (_camera != null)
{
    <h1>Live View: @_camera.Name</h1>
    <div>
        <video id="liveVideoPlayer" controls style="width: 100%;" muted autoplay></video>
    </div>
}
else
{
    <p><em>Loading camera...</em></p>
}

@code {
    [Parameter]
    public int CameraId { get; set; }

    private GFC.Core.Models.Camera _camera;
    private string _hlsUrl;

    protected override async Task OnInitializedAsync()
    {
        _camera = await CameraService.GetCameraByIdAsync(CameraId);
        if (_camera != null)
        {
            var videoAgentBaseUrl = Configuration["VideoAgent:BaseUrl"];
            _hlsUrl = $"{videoAgentBaseUrl}/live/{_camera.Id}/index.m3u8";
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && _camera != null)
        {
            await JSRuntime.InvokeVoidAsync("initializeHlsPlayer", "liveVideoPlayer", _hlsUrl);
        }
    }
}
