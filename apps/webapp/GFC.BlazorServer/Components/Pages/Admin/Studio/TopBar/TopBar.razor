@using GFC.Core.Models
@using GFC.BlazorServer.Services
@inject IStudioService StudioService

<div class="top-bar-container">
    <div class="page-switcher-container">
        <select @onchange="HandlePageChange">
            @if (pages != null)
            {
                foreach (var page in pages)
                {
                    <option value="@(page.Id)">@(page.Title)</option>
                }
            }
        </select>
    </div>
    <div class="device-toggles-container">
        <button @onclick="() => OnDeviceToggle.InvokeAsync(DeviceView.Desktop)">Desktop</button>
        <button @onclick="() => OnDeviceToggle.InvokeAsync(DeviceView.Tablet)">Tablet</button>
        <button @onclick="() => OnDeviceToggle.InvokeAsync(DeviceView.Mobile)">Mobile</button>
    </div>
    <div class="save-buttons-container">
        <!-- Save buttons will go here -->
    </div>
</div>

@code {
    private IEnumerable<StudioPage> pages;

    [Parameter]
    public EventCallback<DeviceView> OnDeviceToggle { get; set; }

    [Parameter]
    public EventCallback<int> OnPageChange { get; set; }

    protected override async Task OnInitializedAsync()
    {
        pages = await StudioService.GetAllPagesAsync();
    }

    private void HandlePageChange(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value.ToString(), out int pageId))
        {
            OnPageChange.InvokeAsync(pageId);
        }
    }

    public enum DeviceView
    {
        Desktop,
        Tablet,
        Mobile
    }
}
