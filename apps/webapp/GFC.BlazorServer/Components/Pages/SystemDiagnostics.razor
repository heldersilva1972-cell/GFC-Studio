@page "/admin/system-diagnostics"
@attribute [Authorize(Policy = AppPolicies.RequireAdmin)]

@using GFC.BlazorServer.Models
@inject DiagnosticsService DiagnosticsService

<PageTitle>System Diagnostics</PageTitle>

<h3 class="mb-4">System Diagnostics</h3>

@if (_info is null)
{
    <div class="text-muted">Loading diagnosticsâ€¦</div>
}
else
{
    <div class="row g-3">
        <div class="col-md-4">
            <div class="summary-card p-3 h-100">
                <h5>Application</h5>
                <p class="mb-1"><strong>Environment:</strong> @_info.EnvironmentName</p>
                <p class="mb-0"><strong>Version:</strong> @_info.ApplicationVersion</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="summary-card p-3 h-100">
                <h5>Database</h5>
                <p class="mb-1"><strong>Provider:</strong> @_info.DatabaseProvider</p>
                <p class="mb-1"><strong>Server:</strong> @_info.DatabaseServer</p>
                <p class="mb-1"><strong>Database:</strong> @_info.DatabaseName</p>
                <p class="mb-0"><strong>Connection:</strong> @_info.GfcConnectionStringName</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="summary-card p-3 h-100">
                <h5>Agent API</h5>
                <p class="mb-1"><strong>Base URL:</strong> @_info.AgentApiBaseUrl</p>
                @if (_info.AgentApiReachable is null)
                {
                    <p class="mb-0">Reachability: <em>Not checked</em></p>
                }
                else if (_info.AgentApiReachable == true)
                {
                    <p class="mb-0 text-success">Reachability: OK</p>
                }
                else
                {
                    <p class="mb-0 text-danger">Reachability: Failed</p>
                    @if (!string.IsNullOrWhiteSpace(_info.AgentApiError))
                    {
                        <small class="text-muted d-block">@_info.AgentApiError</small>
                    }
                }
            </div>
        </div>
    </div>
}

@code
{
    private SystemDiagnosticsInfo? _info;

    protected override async Task OnInitializedAsync()
    {
        _info = await DiagnosticsService.GetDiagnosticsAsync();
    }
}

