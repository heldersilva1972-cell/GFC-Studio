@* Edit Payment Modal - INSERT THIS AFTER LINE 648 (after Payment Success Modal) *@
@if (_showEditPaymentModal && _editPaymentTarget != null)
{
    <div class="modal-backdrop fade show"></div>
    <div class="modal fade show d-block" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg modal-glass">
                <div class="modal-header border-bottom-0">
                    <div class="d-flex align-items-center w-100">
                        <div class="icon-shape bg-warning-subtle text-warning me-3">
                            <i class="bi bi-pencil-square"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="modal-title fw-bold mb-0">Edit Payment</h5>
                            <small class="text-muted">@_editPaymentTarget.FullName - ID: @_editPaymentTarget.MemberId</small>
                        </div>
                        <button type="button" class="btn-close" @onclick="CloseEditPaymentModal"></button>
                    </div>
                </div>
                <div class="modal-body">
                    <EditForm Model="_editPaymentForm" OnValidSubmit="PromptEditPaymentConfirmation">
                        <DataAnnotationsValidator />
                        
                        <div class="alert alert-warning border-0 mb-4">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Caution:</strong> Editing this payment will update the record and log the change for audit purposes.
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label small text-muted text-uppercase fw-bold">Amount</label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-white text-muted">$</span>
                                    <InputNumber class="form-control fw-bold" @bind-Value="_editPaymentForm.Amount" />
                                </div>
                                <ValidationMessage For="@(() => _editPaymentForm.Amount)" />
                            </div>
                            
                            <div class="col-12">
                                <label class="form-label small text-muted text-uppercase fw-bold">Date</label>
                                <div class="d-flex gap-2">
                                    <select class="form-select" @bind="_editPaymentMonth" @bind:after="UpdateEditPaymentDate">
                                        <option value="0">Month</option>
                                        <option value="1">01 - January</option>
                                        <option value="2">02 - February</option>
                                        <option value="3">03 - March</option>
                                        <option value="4">04 - April</option>
                                        <option value="5">05 - May</option>
                                        <option value="6">06 - June</option>
                                        <option value="7">07 - July</option>
                                        <option value="8">08 - August</option>
                                        <option value="9">09 - September</option>
                                        <option value="10">10 - October</option>
                                        <option value="11">11 - November</option>
                                        <option value="12">12 - December</option>
                                    </select>
                                    <select class="form-select" @bind="_editPaymentDay" @bind:after="UpdateEditPaymentDate">
                                        <option value="0">Day</option>
                                        @for (int i = 1; i <= 31; i++)
                                        {
                                            <option value="@i">@i</option>
                                        }
                                    </select>
                                    <select class="form-select" @bind="_editPaymentYear" @bind:after="UpdateEditPaymentDate">
                                        <option value="0">Year</option>
                                        @for (int year = DateTime.Today.Year; year >= DateTime.Today.Year - 5; year--)
                                        {
                                            <option value="@year">@year</option>
                                        }
                                    </select>
                                </div>
                                <ValidationMessage For="@(() => _editPaymentForm.PaidDate)" />
                            </div>
                            
                            <div class="col-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">Method</label>
                                <InputSelect class="form-select" @bind-Value="_editPaymentForm.PaymentType">
                                    @foreach (var method in PaymentMethods)
                                    {
                                        <option value="@method">@method</option>
                                    }
                                </InputSelect>
                                <ValidationMessage For="@(() => _editPaymentForm.PaymentType)" />
                            </div>
                            
                            <div class="col-12">
                                <label class="form-label small text-muted text-uppercase fw-bold">Notes</label>
                                <InputText class="form-control" placeholder="Check #, Reference, etc." @bind-Value="_editPaymentForm.Notes" />
                                <ValidationMessage For="@(() => _editPaymentForm.Notes)" />
                            </div>
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button class="btn btn-warning text-white btn-lg" type="submit" disabled="@_operationInProgress">
                                @if (_operationInProgress)
                                {
                                    <span class="spinner-border spinner-border-sm me-2"></span>
                                    <span>Updating...</span>
                                }
                                else
                                {
                                    <i class="bi bi-check-circle me-2"></i>
                                    <span>Update Payment</span>
                                }
                            </button>
                            <button type="button" class="btn btn-light" @onclick="CloseEditPaymentModal" disabled="@_operationInProgress">Cancel</button>
                        </div>
                    </EditForm>
                </div>
            </div>
        </div>
    </div>
}
